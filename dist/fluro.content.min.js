angular.module("fluro.content",["fluro.util"]),angular.module("fluro.content").service("FluroContent",function($resource,CacheManager,Fluro){var controller={};return controller.resource=function(type,ignoreLoadingBar,noCache){var cache=CacheManager.get(type);return noCache&&(cache=!1),$resource(Fluro.apiURL+"/content/"+type+"/:id",{},{update:{method:"PUT",ignoreLoadingBar:ignoreLoadingBar},save:{method:"POST",ignoreLoadingBar:ignoreLoadingBar},query:{method:"GET",isArray:!0,cache:cache,ignoreLoadingBar:!0},batch:{method:"POST",ignoreLoadingBar:!0}})},controller.endpoint=function(path,ignoreLoadingBar,noCache){var cache=CacheManager.get(path);return noCache&&(cache=!1),$resource(Fluro.apiURL+"/"+path,{},{update:{method:"PUT",ignoreLoadingBar:ignoreLoadingBar},save:{method:"POST",ignoreLoadingBar:ignoreLoadingBar},query:{method:"GET",isArray:!0,cache:cache,ignoreLoadingBar:!0},batch:{method:"POST",ignoreLoadingBar:!0}})},controller}),angular.module("fluro.content").service("FluroContentRetrieval",function($cacheFactory,Fluro,$q,$http){var controller={},cache={};return controller.query=function(queryDetails,typeName,id){return id?$http.get(Fluro.apiURL+"/_query/"+id):typeName&&typeName.length?$http.post(Fluro.apiURL+"/content/"+typeName+"/_query",queryDetails):$http.post(Fluro.apiURL+"/content/_query",queryDetails)},controller.populate=function(contentArray){var ids=_.map(contentArray,function(item){return item._id?item._id:item});return controller.get(ids)},controller.get=function(ids){function finish(){var results=_.map(ids,function(id){return cache[id]});deferred.resolve(results)}var deferred=$q.defer(),requiredIds=_.filter(ids,function(id){return!cache[id]});return requiredIds.length?controller.query({_id:{$in:requiredIds}}).then(function(res){_.each(res.data,function(item){console.log("Create and Cache",item.title),cache[item._id]=item}),finish()},function(res){deferred.reject(res)}):finish(),deferred.promise},controller});